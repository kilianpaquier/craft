# Code generated by craft; DO NOT EDIT.

name: Version
description: Compute the next release version or release it

inputs:
  download_dist:
    description: Whether to build artifact into dist folder or not
    default: false
  dry_run:
    description: Dry run
    default: true
  token:
    description: Github access token
    required: true
outputs:
  branch_sha: 
    description: The concerned branch sha256 value
    value: ${{ steps.version.outputs.branch_sha }}
  release:
    description: Whether a release can be made or not
    value: ${{ steps.version.outputs.release }}
  version: 
    description: The computed version
    value: ${{ steps.version.outputs.version }}

runs:
  using: composite
  steps:
    - id: version
      run: |
        BRANCH_SHA=$(echo "${GITHUB_REF_NAME}" | sha256sum | cut -c -8)
        echo "branch_sha=${BRANCH_SHA}" >> $GITHUB_OUTPUT

        git fetch --tags

        LAST_TAG=$(git tag --list | sort -V | tail -n1)

        NEXT_TAG=${LAST_TAG-1.0.0}
        NEXT_TAG=${NEXT_TAG%-*}

        echo "version=v${NEXT_TAG#v}-build.${BRANCH_SHA}" >> $GITHUB_OUTPUT
        echo "release=false" >> $GITHUB_OUTPUT
    - run: echo $VERSION
      env:
        VERSION: ${{ steps.version.outputs.version }}