# Code generated by craft; DO NOT EDIT.

---
include:

  # Docker template
  - project: "to-be-continuous/docker"
    ref: "5"
    file: "templates/gitlab-ci-docker.yml"

  # Go template
  - project: "to-be-continuous/golang"
    ref: "4"
    file: "templates/gitlab-ci-golang.yml"

variables:
  GO_IMAGE: "registry.hub.docker.com/library/golang:latest"
  GO_TEST_IMAGE: "registry.hub.docker.com/library/golang:latest"
  GO_TEST_FLAGS: "-coverpkg=./... -covermode=count"
  GO_CI_LINT_IMAGE: "registry.hub.docker.com/golangci/golangci-lint:latest-alpine"
  GO_CI_LINT_ARGS: "--config .golangci.yml --timeout 240s --fast --sort-results"
  GO_SBOM_DISABLED: "true"

  DOCKER_KANIKO_IMAGE: "gcr.io/kaniko-project/executor:debug"
  DOCKER_SNAPSHOT_IMAGE: "${CI_REGISTRY_IMAGE}:${SEMREL_INFO_NEXT_VERSION}"
  DOCKER_RELEASE_IMAGE: "${CI_REGISTRY_IMAGE}:${SEMREL_INFO_NEXT_VERSION}"
  DOCKER_RELEASE_EXTRA_TAGS: "latest \\g<major>.\\g<minor> \\g<major"
  DOCKER_METADATA: |
    --label org.opencontainers.image.created=${CI_JOB_STARTED_AT}
    --label org.opencontainers.image.ref.name=${CI_COMMIT_REF_NAME}
    --label org.opencontainers.image.version=${SEMREL_INFO_NEXT_VERSION}
    --label org.opencontainers.image.revision=${CI_COMMIT_SHA}
  DOCKER_SEMREL_RELEASE_DISABLED: "true"
  DOCKER_HEALTHCHECK_DISABLED: "true"
  DOCKER_TRIVY_SECURITY_LEVEL_THRESHOLD: "MEDIUM,HIGH,CRITICAL"
  DOCKER_TRIVY_ARGS: "--ignore-unfixed --exit-code 1 --exit-on-eol 1"
  DOCKER_SBOM_DISABLED: "true"

go-build:
  image: ghcr.io/goreleaser/goreleaser:latest
  script:
    - goreleaser release --clean --config .goreleaser.yml --skip=validate --skip=announce --skip=publish --snapshot
  artifacts:
    name: "$CI_JOB_NAME artifacts from $CI_PROJECT_NAME on $CI_COMMIT_REF_SLUG"
    paths:
      - dist
      - checksums.txt
    expire_in: 1 day