# Code generated by craft; DO NOT EDIT.

#############################
#        STAGE BUILD        #
#############################
FROM golang:1.22 AS build

WORKDIR /app

COPY . .

# hadolint ignore=DL3059
RUN go mod download
# hadolint ignore=DL3059
RUN CGO_ENABLED=0 go build -o craft-api cmd/craft-api/main.go
# hadolint ignore=DL3059
RUN CGO_ENABLED=0 go build -o cli-name cmd/cli-name/main.go
# hadolint ignore=DL3059
RUN CGO_ENABLED=0 go build -o cron-name cmd/cron-name/main.go
# hadolint ignore=DL3059
RUN CGO_ENABLED=0 go build -o job-name cmd/job-name/main.go
# hadolint ignore=DL3059
RUN CGO_ENABLED=0 go build -o worker-name cmd/worker-name/main.go

#############################
#         STAGE RUN         #
#############################
FROM gcr.io/distroless/static-debian12:nonroot

LABEL org.opencontainers.image.authors="maintainer name"
LABEL org.opencontainers.image.vendor="maintainer name"

LABEL org.opencontainers.image.title="craft"
LABEL org.opencontainers.image.licenses="MIT"
LABEL org.opencontainers.image.url="github.com/kilianpaquier/craft"
LABEL org.opencontainers.image.source="github.com/kilianpaquier/craft"
LABEL org.opencontainers.image.documentation="github.com/kilianpaquier/craft"

WORKDIR /app

COPY --from=build \
    /app/craft-api \
    /app/cli-name \
    /app/cron-name \
    /app/job-name \
    /app/worker-name \
    ./
COPY launcher.sh launcher.sh

EXPOSE 5000

ENTRYPOINT [ "/app/launcher.sh" ]