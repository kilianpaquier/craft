# Code generated by craft; DO NOT EDIT.

name: Netlify
run-name: Netlify

<<- $nodejs := hasKey .Languages "nodejs" >>
<<- $hugo := hasKey .Languages "hugo" >>

on:
  workflow_call:
  workflow_dispatch:
<<- if .CI.Static.Auto >>
  push:
    branches:
      - alpha
      - beta
      - dev
      - develop
      - development
      - next
      - staging
<<- /* avoid deploying two times when static and release are in auto mode */ ->>
<<- if not .IsAutoRelease >>
      - main
      - master
      - v[0-9]+.[0-9]+.x
      - v[0-9]+.x
<<- end >>
<<- end >>

jobs:

<<- if $hugo >>

  hugo:
    name: Hugo
    uses: ./.github/workflows/hugo.yml
<<- end >>

<<- if $nodejs >>

  node:
    name: Node
    uses: ./.github/workflows/nodejs.yml
<<- end >>

  netlify:
    name: Netlify
    runs-on: ubuntu-latest
    environment:
      name: netlify
      url: ${{ steps.netlify.outputs.deploy-url }}
    permissions:
      deployments: write
      pull-requests: write
    needs:
<<- if $hugo >>
      - hugo
<<- end >>
<<- if $nodejs >>
      - node
<<- end >>
    steps:
      - uses: actions/checkout@v4
      - id: branch_sha
        run: |
          BRANCH_SHA=$(echo "${GITHUB_REF_NAME}" | sha256sum | cut -c -8)
          echo "branch_sha=${BRANCH_SHA}" >> $GITHUB_OUTPUT
      - uses: actions/download-artifact@v4
        with:
          name: build
          path: dist
      - id: netlify
        uses: nwtgck/actions-netlify@v3
        with:
          alias: ${{ steps.branch_sha.outputs.branch_sha }}
          deploy-message: ${{ github.ref_name }}
          enable-commit-comment: false
          enable-commit-status: false
          github-deployment-environment: netlify
          github-token: ${{ secrets.GITHUB_TOKEN }}
          netlify-config-path: netlify.toml
          production-branch: ${{ github.event.repository.default_branch }}
          publish-dir: dist
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}