# Code generated by craft; DO NOT EDIT.

name: Netlify
run-name: Netlify

on:
  workflow_call:
  workflow_dispatch:
<<- if .CI.Static.Auto >>
  push:
    branches:
      - main
      - master
      - v[0-9]+.x
      - v[0-9]+.[0-9]+.x
<<- end >>

jobs:

  build:
    name: Build
    if: ${{ github.event_name == 'workflow_dispatch' }}
    uses: ./.github/workflows/build.yml

  netlify:
    name: Netlify
    runs-on: ubuntu-latest
    environment:
      name: netlify
      url: ${{ steps.netlify.outputs.deploy-url }}
    permissions:
      deployments: write
      pull-requests: write
    needs:
      - version
      - build
    steps:
      - id: branch_sha
        run: |
          BRANCH_SHA=$(echo "${GITHUB_REF_NAME}" | sha256sum | cut -c -8)
          echo "branch_sha=${BRANCH_SHA}" >> $GITHUB_OUTPUT
      - uses: actions/download-artifact@v4
        with:
          name: build
          path: dist
      - id: netlify
        uses: nwtgck/actions-netlify@v3
        with:
          alias: ${{ steps.branch_sha.outputs.branch_sha }}
          deploy-message: ${{ github.ref_name }}
          enable-commit-comment: false
          enable-commit-status: false
          github-deployment-environment: netlify
          github-token: ${{ secrets.GITHUB_TOKEN }}
          netlify-config-path: netlify.toml
          production-branch: ${{ github.event.repository.default_branch }}
          publish-dir: dist
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}