# Code generated by craft; DO NOT EDIT.

{{- $fullname := include (print .Chart.Name ".fullname") . -}}
{{- $labels := include (print .Chart.Name ".labels") . -}}
{{- $selectorLabels := include (print .Chart.Name ".selectorLabels") . -}}
{{- $serviceAccountName := include (print .Chart.Name ".serviceAccountName") . -}}

{{ range $name, $config := .Values.crons }}
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: {{ print $fullname "-" $name }}
  labels:
    {{- $labels | nindent 4 }}
spec:
  suspend: {{ $config.suspend }}
  schedule: {{ $config.schedule | quote }}
  concurrencyPolicy: {{ $config.concurrencyPolicy }}
  failedJobsHistoryLimit: {{ $config.failedJobsHistoryLimit }}
  successfulJobsHistoryLimit: {{ $config.successfulJobsHistoryLimit }}
  jobTemplate:
    spec:
      completionMode: {{ $config.completionMode }}
      completions: {{ $config.completions }}
      parallelism: {{ $config.parallelism }}
      selector:
        matchLabels:
          {{- $selectorLabels | nindent 10 }}
      template:
        metadata:
          {{- with $config.podAnnotations }}
          annotations:
            {{- toYaml . | nindent 12 }}
          {{- end }}
          labels:
            {{- $selectorLabels | nindent 12 }}
        spec:
          {{- with $.Values.imagePullSecrets }}
          imagePullSecrets:
            {{- toYaml . | nindent 12 }}
          {{- end }}
          serviceAccountName: {{ $serviceAccountName }}
          securityContext:
            {{- toYaml $config.podSecurityContext | nindent 12 }}
          containers:
            - name: {{ $name }}
              securityContext:
                {{- toYaml $config.securityContext | nindent 16 }}
              image: "{{ $config.image.registry }}{{ $config.image.repository }}:{{ $config.image.tag | default $.Chart.AppVersion }}"
              imagePullPolicy: {{ $config.image.pullPolicy }}
              {{- with $config.env }}
              env:
                {{- range $name, $value := . }}
                - name: {{ $name }}
                  value: {{ $value | quote }}
                {{- end }}
              {{- end }}
              {{- with $config.envFrom }}
              envFrom:
                {{- toYaml . | nindent 16 }}
              {{- end }}
              {{- if or $config.configMap $config.volumeMounts }}
              volumeMounts:
                {{- with $config.configMap }}
                - name: {{ print $fullname "-" $name }}
                  mountPath: {{ .mountPath }}
                {{- end }}
                {{- with $config.volumeMounts }}
                {{- toYaml . | nindent 16 }}
                {{- end }}
              {{- end }}
              resources:
                {{- toYaml $config.resources | nindent 16 }}
          restartPolicy: {{ $config.restartPolicy }}
          {{- if or $config.configMap $config.volumes }}
          volumes:
            {{- with $config.configMap }}
            - name: {{ print $fullname "-" $name }}
              configMap:
                name: {{ print $fullname "-" $name }}
            {{- end }}
            {{- with $config.volumes }}
            {{- toYaml . | nindent 12 }}
            {{- end }}
          {{- end }}
          {{- with $config.nodeSelector }}
          nodeSelector:
            {{- toYaml . | nindent 12 }}
          {{- end }}
          {{- with $config.affinity }}
          affinity:
            {{- toYaml . | nindent 12 }}
          {{- end }}
          {{- with $config.tolerations }}
          tolerations:
            {{- toYaml . | nindent 12 }}
          {{- end }}
{{ end }}